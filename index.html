


<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Super Morpion Deluxe</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Segoe UI',Arial;
  background:linear-gradient(135deg,#141e30,#243b55);
  color:#fff;
  text-align:center;
  overflow:hidden;
}
.screen{display:none;padding-top:40px}
.active{display:block}
h1,h2{margin-bottom:20px}
button{
  padding:14px 28px;
  margin:10px;
  border:none;
  border-radius:30px;
  font-size:16px;
  cursor:pointer;
  background:linear-gradient(135deg,#ff9a9e,#fad0c4);
  color:#222;
  font-weight:700;
  transition:transform .15s,box-shadow .15s;
}
button:hover{transform:scale(1.05);box-shadow:0 8px 20px rgba(0,0,0,.3)}
input{
  padding:12px;
  border-radius:20px;
  border:none;
  width:220px;
  text-align:center;
  font-size:16px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(3,100px);
  gap:12px;
  justify-content:center;
  margin:20px auto;
}
.cell{
  width:100px;
  height:100px;
  font-size:42px;
  border-radius:20px;
  background:rgba(255,255,255,.15);
  border:none;
  color:#fff;
  cursor:pointer;
  transition:background .2s,transform .1s;
}
.cell:hover{background:rgba(255,255,255,.3)}
.cell:active{transform:scale(.95)}
#status{font-size:20px;margin:10px}
#score{margin-top:10px;font-weight:bold}
canvas{position:fixed;top:0;left:0;pointer-events:none}
</style>
</head>

<body>

<canvas id="fx"></canvas>

<div id="menu" class="screen active">
  <h1>ðŸŽ® Super Morpion Deluxe</h1>
  <button onclick="selectMode('ia')">ðŸ¤– Mode IA</button>
  <button onclick="selectMode('pvp')">ðŸ‘¥ Mode 2 joueurs</button>
</div>

<div id="names" class="screen">
  <h2>Entrez les noms</h2>
  <input id="n1" placeholder="Joueur 1"><br><br>
  <input id="n2" placeholder="Joueur 2 / IA"><br><br>
  <button onclick="start()">Commencer</button>
</div>

<div id="game" class="screen">
  <h2 id="status"></h2>
  <div class="grid" id="grid"></div>
  <div id="score"></div>
  <button onclick="nextRound()">Manche suivante</button>
</div>

<script>
/* ===== AUDIO SAFE ===== */
let audioOn=false,ctx;
function enableAudio(){
  if(!audioOn){
    ctx=new (window.AudioContext||window.webkitAudioContext)();
    audioOn=true;
  }
}
function beep(f,d){
  if(!audioOn)return;
  let o=ctx.createOscillator(),g=ctx.createGain();
  o.frequency.value=f;o.connect(g);g.connect(ctx.destination);
  o.start();
  g.gain.setValueAtTime(.25,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+d);
  o.stop(ctx.currentTime+d);
}

/* ===== GAME LOGIC ===== */
let mode,board,current="X",round=1,scoreX=0,scoreO=0,over=false;
let p1,p2;
const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function selectMode(m){mode=m;show('names')}

function start(){
  p1=document.getElementById('n1').value||"Joueur 1";
  p2=document.getElementById('n2').value||(mode=='ia'?"IA":"Joueur 2");
  board=Array(9).fill("");
  build();
  updateStatus();
  show('game');
}

function build(){
  let g=document.getElementById('grid');g.innerHTML="";
  for(let i=0;i<9;i++){
    let b=document.createElement('button');
    b.className='cell';
    b.onclick=()=>play(i);
    g.appendChild(b);
  }
}

function play(i){
  enableAudio();
  if(board[i]||over)return;
  board[i]=current;
  document.getElementsByClassName('cell')[i].innerText=current;
  beep(600,.08);

  if(check(current))return end(current);
  if(board.every(c=>c))return end(null);

  current=current=="X"?"O":"X";
  updateStatus();
  if(mode=='ia'&&current=='O')setTimeout(aiMove,350);
}

function aiMove(){
  let m=minimax(board,"O").index;
  play(m);
}

function minimax(b,p){
  let a=b.map((v,i)=>v==""?i:null).filter(v=>v!=null);
  if(check("X"))return{score:-10};
  if(check("O"))return{score:10};
  if(!a.length)return{score:0};
  let moves=[];
  for(let i of a){
    let m={index:i};
    b[i]=p;
    m.score=minimax(b,p=="O"?"X":"O").score;
    b[i]="";
    moves.push(m);
  }
  return p=="O"?moves.reduce((a,b)=>a.score>b.score?a:b)
               :moves.reduce((a,b)=>a.score<b.score?a:b);
}

function check(p){return wins.some(w=>w.every(i=>board[i]==p))}

function end(w){
  over=true;
  if(w){
    fire();
    beep(w=="X"?900:200,.4);
    w=="X"?scoreX++:scoreO++;
  }
  document.getElementById('score').innerText=
    `${p1}: ${scoreX} | ${p2}: ${scoreO} â€” Manche ${round}/3`;
}

function nextRound(){
  if(round>=3){
    alert(scoreX>scoreO?`${p1} gagne !`:scoreO>scoreX?`${p2} gagne !`:"Ã‰galitÃ© !");
    location.reload();
  }
  round++;board=Array(9).fill("");over=false;current="X";
  document.querySelectorAll('.cell').forEach(c=>c.innerText="");
  updateStatus();
}

function updateStatus(){
  document.getElementById('status').innerText=
    current=="X"?`${p1} joue`:`${p2} joue`;
}

/* ===== FIREWORKS ===== */
function fire(){
  let c=document.getElementById('fx'),x=c.getContext('2d');
  c.width=innerWidth;c.height=innerHeight;
  for(let i=0;i<120;i++){
    x.fillStyle=`hsl(${Math.random()*360},100%,60%)`;
    x.beginPath();
    x.arc(Math.random()*c.width,Math.random()*c.height,4,0,6.28);
    x.fill();
  }
  setTimeout(()=>x.clearRect(0,0,c.width,c.height),900);
}
</script>

</body>
</html>
